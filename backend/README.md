## City_Stats_V2 Backend

### Introduction

CityStats is a simple Read Only REST API that delivers statistics about all 50 states
within the United States of America as well as the top 330 most populated cities
within the United States.

**Cloning This Repo For Development**

Should you wish to clone/fork this repository for educational purposes or
personal development, please follow the following instructions for ease of use:

1. Clone The Repository

```
git clone https://github.com/tomit4/city_stats_v2
```

2. Navigate to the backend directory and install all the necessary packages
   using npm (if you haven't already done so, [install nodejs and npm](https://docs.npmjs.com/downloading-and-installing-node-js-and-npm)).

```
cd city_stats_v2/backend && npm install
```

3. Copy the .env.sample file as .env and change the PORT and DOCKERPORT numbers
   to whichever you'd prefer.

4. Navigate to the backend/scripts directory and follow the instructions in the
   readme there. This will bring in all images and generate the base json files
   which will be utilized to populate the database (due to the amount of data
   generated by these scripts and depending on your network connection
   speeds, this process might take a while, grab a coffee...).

5. Once you have finalized the downloads and run the npm scripts to set up the
   mock and seed the database, you should be able to simple run the development
   server using npm:

    ```
    npm run dev
    ```

6. Finally, navigate to your localhost and input the $PORT number you inputted
   as a variable. If, for whatever reason you forgot to adjust the .env file,
   the server will attempt to default to port number 6969. The root of the
   backend API does not currently return any data, so you'll need to at least input either
   states or cities following the port number and a forward slash.

    ```
    localhost:$PORT/states
    ```

**Docker**

The production version of this application utilizes docker and NGINX on a simple Linux
Cloud Server. This readme will forego explaining the set up of registering and
configuring a domain and NGINX, but I will briefly document how to quickly set
up the docker container.

Included in this backend repository are the appropriate docker configuration
files (.dockerignore, docker-compose.yml, and Dockerfile). To set up the docker
container, you'll need to ensure that both $PORT and $DOCKERPORT environment
variables are set within your .env file. Unlike running the development server
natively, where the $PORT environment variable, if not found, will default to
6969, this is not the case with docker, which will fail with an error if either
$PORT or $DOCKERPORT variables are not defined.

You'll need to install both docker and docker-compose to proceed spinning up the
docker container. Once both packages are installed, simply invoke docker-compose
to spin up the container:

```
docker-compose up -d citystats
```

Once set up, you should be able to navigate to your localhost, now with the
$DOCKERPORT appended to the URL string to see the dev server running within
docker:

```
localhost:$DOCKERPORT/states
```

**A Brief Note on NGINX and Let's Encrypt**

In production, this port is then forwarded out to an NGINX instance that serves
it out to the world wide web, and utilizes a cron job that renews its SSL
certificates via the certbot package and is officiated via Let's Encrypt.
